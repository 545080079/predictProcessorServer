<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Index</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdn.bootcss.com/vue-resource/1.0.3/vue-resource.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>
<body>

<div class="container">
    <!-- Static navbar -->
    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">Project name</a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#">Home</a></li>
                    <li><a href="#">About</a></li>
                    <li><a href="#">Contact</a></li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="#">Action</a></li>
                            <li><a href="#">Another action</a></li>
                            <li><a href="#">Something else here</a></li>
                            <li role="separator" class="divider"></li>
                            <li class="dropdown-header">Nav header</li>
                            <li><a href="#">Separated link</a></li>
                            <li><a href="#">One more separated link</a></li>
                        </ul>
                    </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li class="active"><a href="./">Default <span class="sr-only">(current)</span></a></li>
                    <li><a href="../navbar-static-top/">Static top</a></li>
                    <li><a href="../navbar-fixed-top/">Fixed top</a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div><!--/.container-fluid -->
    </nav>

    <!-- Main component for a primary marketing message or call to action -->
    <div class="jumbotron">
        <h1>Navbar example</h1>
        <p>This example is a quick exercise to illustrate how the default, static navbar and fixed to top navbar work. It includes the responsive CSS and HTML, so it also adapts to your viewport and device.</p>
        <p>
            <a class="btn btn-lg btn-primary" href="../../components/#navbar" role="button">View navbar docs &raquo;</a>
        </p>
    </div>

</div> <!-- /container -->

<div class="row placeholders">
    <div id="app">
        <div id="codearea" class="col-xs-15 col-sm-5 placeholder">
            <img src="./icon_nodearea.png" id="icon_nodearea" style="display: none"/>
            {{ message }}
            <span>[代码编辑框]</span>
            <textarea v-model="code" placeholder="write TCSL code in it." style="width: 800px; height: 400px"></textarea>
            <button v-on:click="btnSubmit">解析</button>
            DAGraph{{dataJson}}
        </div>
        <div id="grapharea" class="col-xs-15 col-sm-5 placeholder">
            <button v-on:click="btnRefresh">DAGraph构造</button>

            <iframe id="graph" src="graph.html" height="1000" width="800"></iframe>
        </div>
    </div>
</div>


<div id="executor">

</div>


<script>
    var app = new Vue({
        el: '#app',
        data: {
            message: 'Welcome to index page.',
            code: '',
            dataJson: '',
            preUrl: '/v1/parser/parse?definition=',
            dataUrl: '',
            graphUrl: '/v1/view/gen?definition=',
            graphHtml: null,
        },
        created: function() {
            this.init()
            this.getData()
        },
        methods: {
            init: function () {

            },
            htmlFilter: function(text) {
                return text.replace(/[{}]/g, function (match, pos, originalText) {
                    switch (match) {
                        case "{": return "%7B";
                        case "}": return "%7D";
                    }
                });
            },
            btnRefresh: function () {
                var that = this;
                that.dataUrl = that.graphUrl + that.htmlFilter(that.code)
                that.$http({
                    method: 'GET',
                    url: this.dataUrl,
                }).then(function(response){
                    document.getElementById('graph').contentWindow.location.reload(true);
                },function (error) {
                })
            },
            btnSubmit: function() {
                this.getData()
            },
            getData: function () {
                var that = this;
                that.dataUrl = that.preUrl + that.htmlFilter(that.code)
                that.$http({
                    method: 'GET',
                    url: this.dataUrl,
                }).then(function(response){
                    this.dataJson = response.data
                },function (error) {
                })
            }
        }
    })

    var executor = new Vue({
        el: '#executor',
        data: {

        },
        created: function () {
            this.init()
        },

    })
</script>
</body>
</html>